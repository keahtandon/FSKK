---
title: "Project G: Collaborating on Projects"
author: "FSKK: Fang Wang, Shea Ferguson, Kelley Lewis, Keah Tandon"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output:
  html_document:
    df_print: paged
---

*This project will require you to collaborate with some of your fellow students to complete a statistical analysis and report. Here are some of the tasks that you must accomplish.*

* Create a public GitHub repository with an RStudio project file (team leader)

* Put a description of the project in the README.md file (team leader)

* Email team members and Mike the repository address (team leader)

* Write a short introduction

* Provide a graphical display and descriptive statistics to compare groups

* Conduct an analysis of variance (ANOVA) for omnibus inference

* Check the conditions necessary for valid ANOVA inference

* Conduct a bootstrap for omnibus inference without needing conditions

* Construct Tukey pairwise confidence intervals (if appropriate)

* Write a conclusions section

* Assemble a complete knittable report (team leader)

*If you write any functions, put these in a **Functions** folder. Put data in a **Data** folder. These should be subfolders in your main project folder. Your finished notebook should be neat and organized. Save this notebook with your team name and **Project G** in the file name, rather than the report title. Leave the instructions in place and begin your report after the last horizontal line below. All team members will receive the same score for this project. (40 points possible)*

***

The *HSB2 Data* includes variables collected on a random sample of high school seniors. Conduct an analysis to compare performance on the test variable assigned to your team for the three socioeconomic groups. Include a graphical display and descriptive statistics. Also include an omnibus analysis that assumes valid conditions for parametric inference (ANOVA) as well as an omnibus analysis that does not assume these conditions (bootstrap). Construct pairwise Tukey confidence intervals, if appropriate.

***

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Domine">

```{r setup, include=FALSE}

rm(list = ls())

library(here)
library(showtext)
library(shiny)
library(ggplot2)
library(dplyr)
library(kableExtra)
library(GGally)
library(DiagrammeR)
library(tidyverse)

font_add_google(name = "Domine", family = "domine") 
font_add_google(name = "Montserrat", family = "Montserrat")
showtext_auto()

hsb2 <- read.csv(here("Data", "hsb2.csv"), header = TRUE, sep = ",")

hsb2$ses <- factor(hsb2$ses,
                         labels = c("Low",
                                    "Medium",
                                    "High"))

# Color scheme
  #8540A0
  #5462B6
  #62a87c
  #7ee081
  #c3f3c0

source(here("Functions","Tukey HSD in GG plot.R"))
source(here("Functions","Theme Downcute.R"))

```

``` {css echo=FALSE}

<head>

<style>

body {

  font-family: "Montserrat", sans; 
  font-size: 14px; 

}

.list-group-item.active, .list-group-item.active:focus, .list-group-item.active:hover {
    z-index: 2;
    color: #fff;
    background-color: #8aaa79;
    border-color: #8aaa79;
}

.list-group, .list-group-item {

    color: #0081a7;
    background-color: #FEFCFB;

}

p {

  font-family: "Montserrat", sans; 
  font-size: 14px; 
  color: "black";

}

h1 {

  font-family: "Domine", serif; 
  font-size: 22px; 
  color: #8540A0;

}

h2 {

  font-family: "Domine", serif; 
  font-size: 18px; 
  color: #5462B6; 
  line-height: .5em; 

}

h3 {
  
  font-family: "Domine", serif; 
  font-size: 15px; 
  color: #8540A0; 
  font-weight: "bold"; 

}

h4 {
  
  font-family: "Montserrat", sans; 
  font-size: 18px; 
  color: 'black'; 
  line-height: 2em;
  
}

table {

  font-family: "Montserrat", sans; 
  font-size: 14px; 
  color: 'black';

}

</style>
</head>

```

## Introduction
Researchers wanted to examine what differences may exist in reading scores by SES. In this study, schools were randomly sampled by the National Center of Education Statistics and data was collected for high school seniors. Demographic variables were collected along with reading test scores for both public and private schools. The following report will address the question, do reading test scores differ by SES status? Our hypothesis is that reading scores will be highest for the higher SES group. 

\

## Analysis
Table 1 shows summary statistics for overall reading scores for all students. The mean score was 52.23 (SD = `r round(sd(hsb2$read),2)`).
\

### Table 1: Overall reading scores

```{r descriptives, echo=FALSE}
# sd(hsb2$read)

overall_summary <- as.data.frame.list(summary(hsb2$read))
overall_summary <- overall_summary[,c(1,2,3,5,6,4)]
overall_summary$SD <- sd(hsb2$read)


overall_summary %>%
  kable(longtable = T,
        digits = 2,
        col.names = c("Min",
          "Q1",
          "Median",
          "Q3",
          "Max",
          "Mean",
          "SD")) %>%
    kable_styling(full_width = T) %>%
  row_spec(0, color = "white", background = "#5462B6")  %>%
    row_spec(1, color = "black")
```

After looking at the overall scores, researchers wanted to look at reading scores by SES. Therefore, groups were created to represent low SES, medium SES, and high SES. Figure 1 shows the breakdown of reading scores by SES. Scores were similar among low and medium SES, but higher for the high SES group. 

### Figure 1: Boxplots of reading scores for three SES groups

``` {r boxplots, echo = FALSE}
par(mar = c(5.1,4.1,2.1,2.1))

boxplot(hsb2$read ~ hsb2$ses,
        ylab = "Reading Scores",
        xlab = "SES",
        names = c("Low", "Medium", "High"),
        col = c("aquamarine", "pink", "#5462B6"))

```


Table 2 shows the summary statistics for reading scores by SES status. The mean reading score for low SES was 48.28 (SD = 9.34). The mean reading score for medium SES was 51.58 (SD = 9.43). Lastly, the mean reading score for high SES was 56.5 (SD = 10.86). These results show that high SES group had the greater mean, but also the greater SD among the three groups. Additionally, the minimum and maximum score was highest for the high SES group and lowest for the low SES group. 

### Table 2: SES group five-number summaries, means, and standard deviations for reading scores
```{r echo=FALSE}
tidy_read <- hsb2 %>%
  group_by(ses) %>%
  summarize(
    Min=min(read),
    Q1=quantile(read, probs = 0.25),
    Median=median(read),
    Q3=quantile(read, probs = .75),
    Max=max(read),
    Mean=mean(read),
    SD=sd(read))

  tidy_read %>%
  kable(longtable = T,
        digits=2,
        col.names = c("SES",
                      "Min",
                      "Q1",
                      "Median",
                      "Q3",
                      "Max",
                      "Mean",
                      "SD")) %>%
    kable_styling(full_width = T) %>%
  row_spec(0, color = "white", background = "#5462B6")%>%
    row_spec(1:nrow(tidy_read), color = "black")
```


\

Figure 2 shows that the data points roughly follow a straight line indicating
the data is normally distributed.

### Figure 2: Normal Q-Q plot for residuals in the study

``` {r QQ, echo = FALSE}

par(mar = c(5.1, 4.1, 1.1, 2.1))

# get the model 
model <- lm(hsb2$read ~ hsb2$ses)
# get the Q-Q plot
std_residual <- rstandard(model)
qqnorm(std_residual, main = "")
qqline(std_residual)

```

Figure 3 shows a roughly homoscedastic distribution for residuals for each 
group. In sum, the inference of ANOVA should be valid.

### Figure 3: Residual-fit plot across the three groups
``` {r fit plot, echo = FALSE}

par(mar = c(5.1, 4.1, 1.1, 2.1))

# get the Residual vs. fit plot
plot(model$fitted.values, model$residuals,
     xlab = "Fitted Values",
     ylab = "Residuals")
abline(0,0)

```

Table 3 shows the analysis of variance for reading scores as a function of socioeconomic status. We can reject the null hypothesis of equal means (p < .01) and conclude that reading score is associated with socioeconomic status if the conditions for the inference are met. 

### Table 3: ANOVA for reading scores as a function of SES

``` {r ANOVA, echo = FALSE}

# ANOVA
aov.model <- aov(hsb2$read ~ hsb2$ses)
anova <- summary(aov.model)
anova <-  as.data.frame(do.call(cbind, anova))
anova$`Sum Sq` <- round(anova$`Sum Sq`)
anova$`Mean Sq` <- round(anova$`Mean Sq`,1)
anova$`F value` <- round(anova$`F value`,3)
anova$`Pr(>F)` <- round(anova$`Pr(>F)`,5)
rownames(anova) <- c("SES","Residual")

options(knitr.kable.NA = "")

anova %>%
  kable(longtable = T,
        col.names = c("df",
                      "SS",
                      "MS",
                      "F",
                      "*p*"),
        ) %>%
    kable_styling(full_width = T) %>%
  row_spec(0, color = "white", background = "#5462B6") %>%
    row_spec(1:nrow(anova), color = "black")

```

\

``` {r Tukey, echo = FALSE}

# Run Tukey HSD for the model

Tukey <- TukeyHSD(aov.model)

# Rename the list for Tukey to make inline coding easier.

names(Tukey) <- "confint"

```

Figure 4 illustrates Tukey pairwise comparisons for the three SES groups. I can state, with 95% confidence, that high SES students score higher for reading than either middle SES students (an average of between `r round(Tukey$confint[2,2])` and `r round(Tukey$confint[2,3])` points higher on the reading test) or low SES students (an average of between `r round(Tukey$confint[3,2])` and `r round(Tukey$confint[3,3])` points higher on the reading test) in the population represented by this sample. Although middle SES students score slightly higher on average in the sample than low SES students, this difference cannot be inferred to the population.

\

### Figure 4: Illustration of Tukey confidence intervals for the difference in mean reading score for each pair of SES groups

``` {r Tukey plot, echo = FALSE}

# Plot confidence intervals

GGTukey(Tukey)

```

\

## Conclusions


\

\
